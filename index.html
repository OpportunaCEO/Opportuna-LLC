<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Opportuna â€“ Home</title>
  <meta name="description" content="Opportuna is your personalized job and networking platform. Connect, share, and grow your career." />
  <link rel="stylesheet" href="assets/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Your embedded styles from before for nav, feed, modals, buttons etc. */
    /* ... (keep your previous styles here) ... */
  </style>
</head>
<body>
  <nav class="top-nav">
    <div class="nav-center">
      <a href="index.html" class="nav-link">Home</a>
      <a href="jobSeekers.html" class="nav-link">Job Seekers</a>
      <a href="employers.html" class="nav-link">Employers</a>
      <a href="premium.html" class="nav-link">Premium</a>
      <a href="recommended.html" class="nav-link">Recommended Jobs</a>
      <a href="contact.html" class="nav-link">Contact</a>
    </div>
    <div class="dropdown" id="userDropdown" style="display:none;">
      <img id="navProfilePic" class="profile-icon" src="assets/default.png" alt="User" />
      <div class="dropdown-content">
        <a href="profile.html" id="profileLink">My Profile</a>
        <a href="#" id="logoutBtn">Logout</a>
      </div>
    </div>
    <a href="login.html" id="loginLink">Login</a>
  </nav>

  <div class="main-layout">
    <div class="feed">
      <h2>ðŸ“° Social Feed</h2>
      <section id="postSection"></section>
    </div>
  </div>

  <button id="createPostBtn" title="Create New Post" style="display:none;">+</button>

  <div id="overlay"></div>
  <div id="postModal">
    <h3>Create a New Post</h3>
    <form id="postForm">
      <textarea id="postContent" placeholder="What's on your mind?" required style="width:100%; height:100px;"></textarea>
      <button type="submit">Post</button>
    </form>
  </div>

  <!-- Auth Modal from previous (optional) removed since you have login.html -->

  <footer style="text-align:center; margin:2rem 0 1rem 0; color:#777;">
    <p>&copy; 2025 Opportuna. All rights reserved.</p>
  </footer>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth,
      onAuthStateChanged,
      signOut,
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBAFx0Ad-8RKji4cDNYWm1yPTkx4RpRwWM",
      authDomain: "opportuna-a14bb.firebaseapp.com",
      projectId: "opportuna-a14bb",
      storageBucket: "opportuna-a14bb.appspot.com",
      messagingSenderId: "906149069855",
      appId: "1:906149069855:web:618ed823248443db30812a",
      measurementId: "G-GJGCWL01W4"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // Elements
    const userDropdown = document.getElementById("userDropdown");
    const loginLink = document.getElementById("loginLink");
    const logoutBtn = document.getElementById("logoutBtn");
    const navProfilePic = document.getElementById("navProfilePic");
    const createPostBtn = document.getElementById("createPostBtn");
    const postModal = document.getElementById("postModal");
    const overlay = document.getElementById("overlay");
    const postForm = document.getElementById("postForm");
    const postSection = document.getElementById("postSection");

    let currentUserData = null;

    onAuthStateChanged(auth, user => {
      if (user) {
        loginLink.style.display = "none";
        userDropdown.style.display = "inline-block";
        navProfilePic.src = user.photoURL || "assets/default.png";
        currentUserData = {
          uid: user.uid,
          name: user.displayName || "Anonymous",
          avatar: user.photoURL || "assets/default.png",
          email: user.email
        };
        createPostBtn.style.display = "block";
        loadPosts();
      } else {
        loginLink.style.display = "inline-block";
        userDropdown.style.display = "none";
        createPostBtn.style.display = "none";
        currentUserData = null;
        loadPosts();
      }
    });

    logoutBtn.addEventListener("click", async e => {
      e.preventDefault();
      await signOut(auth);
      window.location.href = "login.html";
    });

    createPostBtn.addEventListener("click", () => {
      postModal.style.display = "block";
      overlay.style.display = "block";
    });

    overlay.addEventListener("click", () => {
      postModal.style.display = "none";
      overlay.style.display = "none";
    });

    postForm.addEventListener("submit", e => {
      e.preventDefault();
      if (!currentUserData) return alert("Please log in to post.");
      const content = document.getElementById("postContent").value.trim();
      if (!content) return;

      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      posts.unshift({
        id: Date.now(),
        content,
        name: currentUserData.name,
        avatar: currentUserData.avatar,
        timestamp: new Date().toISOString(),
        likes: 0,
        comments: []
      });
      localStorage.setItem("posts", JSON.stringify(posts));
      postForm.reset();
      postModal.style.display = "none";
      overlay.style.display = "none";
      loadPosts();
    });

    function loadPosts() {
      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      postSection.innerHTML = posts.length === 0 ? "<p>No posts yet.</p>" : posts.map(p => `
        <article class="post-card">
          <header class="post-header">
            <img src="${p.avatar}" alt="${p.name}" class="post-avatar" />
            <div>
              <strong>${p.name}</strong><br />
              <small>${new Date(p.timestamp).toLocaleString()}</small>
            </div>
          </header>
          <p class="post-content">${p.content}</p>
        </article>
      `).join("");
    }
  </script>
</body>
</html>
