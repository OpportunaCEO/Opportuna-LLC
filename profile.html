<!-- profile.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Your Profile ‚Äì Opportuna</title>
  <link rel="stylesheet" href="assets/style.css" />
</head>
<body>
  <nav class="top-nav">
    <a href="index.html">üè† Home</a>
    <a href="profile.html">üë§ Profile</a>
    <a href="login.html" id="logoutBtn">üö™ Logout</a>
  </nav>

  <main class="container">
    <h2>Your Profile</h2>
    <form id="profileForm" class="form-card">
      <label>Full Name: <input type="text" id="fullName" /></label>
      <label>Bio: <textarea id="bio" rows="3"></textarea></label>
      <label>Skills (comma separated): <input type="text" id="skills" /></label>
      <label>Work Experience: <textarea id="experience" rows="4"></textarea></label>
      <label>Upload Profile Picture:
        <input type="file" id="profilePic" accept="image/*" />
      </label>
      <img id="picPreview" src="" alt="Preview" class="preview-img" />
      <button type="submit">Save Profile</button>
    </form>

    <hr />

    <section id="postSection">
      <h2>Post to Your Feed</h2>
      <form id="postForm" class="form-card">
        <textarea id="postText" placeholder="Share an update, opportunity, or experience..." rows="3" required></textarea>
        <button type="submit">Post</button>
      </form>
      <div id="feedContainer"></div>
    </section>
  </main>

  <script>
    const userEmail = localStorage.getItem("loggedInUser");
    if (!userEmail) window.location.href = "login.html";

    const users = JSON.parse(localStorage.getItem("users")) || {};
    const userData = users[userEmail] || {};

    const nameInput = document.getElementById("fullName");
    const bioInput = document.getElementById("bio");
    const skillsInput = document.getElementById("skills");
    const expInput = document.getElementById("experience");
    const picInput = document.getElementById("profilePic");
    const picPreview = document.getElementById("picPreview");

    // Load saved data
    nameInput.value = userData.name || "";
    bioInput.value = userData.bio || "";
    skillsInput.value = userData.skills || "";
    expInput.value = userData.experience || "";
    if (userData.pic) {
      picPreview.src = userData.pic;
    }

    picInput.addEventListener("change", () => {
      const file = picInput.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          picPreview.src = reader.result;
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById("profileForm").addEventListener("submit", (e) => {
      e.preventDefault();
      const updatedData = {
        ...userData,
        name: nameInput.value,
        bio: bioInput.value,
        skills: skillsInput.value,
        experience: expInput.value,
        pic: picPreview.src || userData.pic || "assets/default.png",
      };
      users[userEmail] = updatedData;
      localStorage.setItem("users", JSON.stringify(users));
      alert("Profile saved!");
    });

    // Feed logic
    const postForm = document.getElementById("postForm");
    const feedContainer = document.getElementById("feedContainer");

    const loadPosts = () => {
      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      feedContainer.innerHTML = posts.reverse().map(p => `
        <div class="post-card">
          <div class="post-header">
            <img src="${p.pic || 'assets/default.png'}" alt="User" class="post-avatar">
            <div>
              <strong>${p.name || "Unknown"}</strong><br>
              <small>${new Date(p.date).toLocaleString()}</small>
            </div>
          </div>
          <p>${p.text}</p>
        </div>
      `).join("");
    };

    postForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const postText = document.getElementById("postText").value;
      const newPost = {
        text: postText,
        name: userData.name || "Anonymous",
        pic: userData.pic || "assets/default.png",
        date: new Date(),
      };
      const posts = JSON.parse(localStorage.getItem("posts")) || [];
      posts.push(newPost);
      localStorage.setItem("posts", JSON.stringify(posts));
      postForm.reset();
      loadPosts();
    });

    loadPosts();

    document.getElementById("logoutBtn").addEventListener("click", (e) => {
      e.preventDefault();
      localStorage.removeItem("loggedInUser");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
